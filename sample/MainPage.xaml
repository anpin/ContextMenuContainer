<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="APES.MAUI.Sample.MainPage"
             xmlns:vm="clr-namespace:APES.MAUI.Sample.ViewModels"
             xmlns:c="http://apes.ge"
             x:DataType="vm:MainViewModel"
             Title="ContextMenuContainer Demo"
             BackgroundColor="#f5f5f5"
             AutomationId="sample_page"
             x:Name="mainPage"
             >
    
    <ContentPage.BindingContext>
        <vm:MainViewModel/>
    </ContentPage.BindingContext>
    
    <ContentPage.Resources>
        <Style x:Key="CardStyle" TargetType="Frame">
            <Setter Property="Margin" Value="12,8" />
            <Setter Property="Padding" Value="16" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="HasShadow" Value="True" />
        </Style>
        <Style x:Key="HeaderStyle" TargetType="Label">
            <Setter Property="FontSize" Value="18" />
            <Setter Property="FontAttributes" Value="Bold" />
            <Setter Property="Margin" Value="12,8,12,0" />
            <Setter Property="TextColor" Value="#3E3E3E" />
        </Style>
        <DataTemplate x:Key="ListItem" x:DataType="vm:Person">
          <c:ContextMenuContainer AutomationId="{Binding AutomationId}">
              <c:ContextMenuContainer.MenuItems>
                  <c:ContextMenuItem 
                      Text="{Binding FirstName, StringFormat='Edit {0}'}"
                      Command="{Binding ViewModel.EditPersonCommand,  Source={x:Reference  mainPage}}"
                      CommandParameter="{Binding .}" 
                      Icon="{Binding ViewModel.SettingsIconSource,  Source={x:Reference  mainPage}}"/>
                  <c:ContextMenuItem 
                      Text="{Binding FirstName, StringFormat='Delete {0}'}"
                      IsDestructive="True"
                      Command="{Binding ViewModel.DeletePersonCommand, Source={x:Reference  mainPage}}" 
                      CommandParameter="{Binding .}" />
              </c:ContextMenuContainer.MenuItems>
              <c:ContextMenuContainer.Content>
                  <Frame Margin="4" Padding="12" BackgroundColor="#00897B" CornerRadius="4">
                      <Grid ColumnDefinitions="40, *">
                          <Border StrokeShape="Ellipse" WidthRequest="32" HeightRequest="32" BackgroundColor="#004D40">
                              <Label Text="{Binding FirstLetter}" TextColor="White" HorizontalOptions="Center" VerticalOptions="Center" FontAttributes="Bold" />
                          </Border>
                          <Label Grid.Column="1" Text="{Binding FullName}" TextColor="White" VerticalOptions="Center" Margin="8,0,0,0" AutomationId="{Binding NameAutomationId}" />
                      </Grid>
                  </Frame>
              </c:ContextMenuContainer.Content>
          </c:ContextMenuContainer>
      </DataTemplate>
    </ContentPage.Resources>
    
    <ScrollView>
        <StackLayout Spacing="8">
            <Label Text="ContextMenuContainer Demo" 
                   FontSize="24" 
                   FontAttributes="Bold" 
                   HorizontalOptions="Center"
                   Margin="0,12,0,0"
                   TextColor="#2B2B2B" />
            
            <Label Text="Tap and hold or right-click on any card to see the context menu" 
                   HorizontalOptions="Center" 
                   FontSize="14"
                   TextColor="#7E7E7E"
                   Margin="0,0,0,8" />
            
            <!-- Basic example with static menu items -->
            <Label Text="Basic Context Menu" Style="{StaticResource HeaderStyle}" />
            <c:ContextMenuContainer x:Name="container1" AutomationId="container1">
                <c:ContextMenuContainer.MenuItems>
                    <c:ContextMenuItem x:Name="c1_action1" AutomationId="c1_action1" Text="Action 1" Command="{Binding FirstCommand}" CommandParameter="Action 1 pressed!" />
                    <c:ContextMenuItem x:Name="c1_action2" AutomationId="c1_action2" Text="Action with icon" Command="{Binding FirstCommand}" CommandParameter="Action with icon pressed!" Icon="{Binding SettingsIconSource}"/>
                </c:ContextMenuContainer.MenuItems>
                <c:ContextMenuContainer.Content>
                    <Frame Style="{StaticResource CardStyle}" BackgroundColor="#4CAF50">
                        <StackLayout>
                            <Label Text="Basic Example" FontSize="16" FontAttributes="Bold" TextColor="White" />
                            <Label AutomationId="c1_label" Text="{Binding Text}" TextColor="White" HorizontalOptions="FillAndExpand" VerticalOptions="Center" />
                        </StackLayout>
                    </Frame>
                </c:ContextMenuContainer.Content>
            </c:ContextMenuContainer>

            <!-- Dynamic menu items example -->
            <Label Text="Dynamic Context Menu Items" Style="{StaticResource HeaderStyle}" />
            <c:ContextMenuContainer x:Name="container2" AutomationId="container2" MenuItems="{Binding ImageContextItems}">
                <c:ContextMenuContainer.Content>
                    <Frame Style="{StaticResource CardStyle}" BackgroundColor="#FFB74D">
                        <Grid RowDefinitions="Auto,Auto,*" ColumnDefinitions="Auto,*">
                            <Label Text="Dynamic Menu Items" Grid.Row="0" Grid.Column="1"
                                   FontSize="16" FontAttributes="Bold" TextColor="#5D4037" />
                            <Label Text="{Binding DynamicSectionText}" Grid.Row="1" Grid.Column="1"
                                   TextColor="#5D4037" FontAttributes="Italic"
                                   AutomationId="c2_label"
                                   />
                            <Label Text="Right-click to see multiple dynamic menu items" Grid.Row="2" Grid.Column="1"
                                   TextColor="#5D4037" />
                        </Grid>
                    </Frame>
                </c:ContextMenuContainer.Content>
            </c:ContextMenuContainer>
            
            <!-- Asynchronous command example -->
            <Label Text="Asynchronous Command" Style="{StaticResource HeaderStyle}" />
            <c:ContextMenuContainer x:Name="container3" AutomationId="container3">
                <c:ContextMenuContainer.MenuItems>
                    <c:ContextMenuItem Text="Start the loop!" IsDestructive="True" Command="{Binding NeverEndingCommand}"/>
                </c:ContextMenuContainer.MenuItems>
                <c:ContextMenuContainer.Content>
                    <Frame Style="{StaticResource CardStyle}" BackgroundColor="#EF5350">
                        <StackLayout>
                            <Label Text="Long-running Commands" FontSize="16" FontAttributes="Bold" TextColor="White" />
                            <Label Text="{Binding NeverEndingCounter, StringFormat='This has never ending command which fired {0} times'}" 
                                   TextColor="White"
                                   AutomationId="c3_label"
                                   />
                        </StackLayout>
                    </Frame>
                </c:ContextMenuContainer.Content>
            </c:ContextMenuContainer>
            
            <!-- Disabled items example -->
            <Label Text="Disabled Menu Items" Style="{StaticResource HeaderStyle}" />
            <c:ContextMenuContainer x:Name="container4" AutomationId="container4">
                <c:ContextMenuContainer.MenuItems>
                    <c:ContextMenuItem Text="Always enabled Action" Command="{Binding ConditionalCommand}"  />
                    <c:ContextMenuItem Text="Always disabled Action" Command="{Binding ConditionalCommand}"  IsEnabled="False" />
                    <c:ContextMenuItem 
                        Text="{Binding IsConditionalActionEnabled, Converter={StaticResource conditionalCommandConverter}}" 
                        IsEnabled="{Binding IsConditionalActionEnabled}" 
                        Command="{Binding ConditionalCommand}" 
                        />
                </c:ContextMenuContainer.MenuItems>
                <c:ContextMenuContainer.Content>
                    <Frame Style="{StaticResource CardStyle}" BackgroundColor="#7986CB">
                        <StackLayout>
                            <Label Text="Disabled Items Example" FontSize="16" FontAttributes="Bold" TextColor="White" />
                            <Label Text="Right-click to see enabled and disabled menu items" TextColor="White" />
                            <Label Text="{Binding ConditionalCommandCounter, StringFormat='Conditional command fired {0} times'}" 
                                   TextColor="White"
                                   AutomationId="c4_label"
                            />
                            <Button Text="{Binding ConditionalActionStatus}" Command="{Binding ToggleConditionalCommand}"
                                    BackgroundColor="#5C6BC0" TextColor="White" Margin="0,8,0,0"
                                    AutomationId="c4_toggle"
                                    />
                        </StackLayout>
                    </Frame>
                </c:ContextMenuContainer.Content>
            </c:ContextMenuContainer>
            

            <!-- CollectionView with Context Menu on Each Item -->
            <Frame Style="{StaticResource CardStyle}" BackgroundColor="#26A69A">
              <StackLayout>
                  <c:ContextMenuContainer x:Name="container5" AutomationId="container5">
                    <c:ContextMenuContainer.MenuItems>
                        <c:ContextMenuItem Text="Add Person" Command="{Binding AddItemCommand}" Icon="{Binding SettingsIconSource}" />
                        <c:ContextMenuItem Text="Clear List" Command="{Binding ClearItemsCommand}" IsDestructive="True" />
                    </c:ContextMenuContainer.MenuItems>
                    <c:ContextMenuContainer.Content>  
                      <StackLayout>
                        <Label Text="CollectionView Per-Item ContextMenu" FontSize="16" FontAttributes="Bold" TextColor="White" />
                        <Label Text="Each item has its own context menu - long press or right-click on any person or on this header to access global actions" TextColor="White" />
                        <Label AutomationId="collection_result_label" Text="{Binding CollectionViewResultText}" TextColor="White" FontAttributes="Italic" />  
                      </StackLayout>
                    </c:ContextMenuContainer.Content>
                  </c:ContextMenuContainer>
                  <CollectionView ItemsSource="{Binding ListItems}" ItemTemplate="{StaticResource ListItem}" HeightRequest="200" AutomationId="people_collection"  EmptyView="No items in the collection" />
              </StackLayout>
            </Frame>


            <BoxView HeightRequest="20" />


        </StackLayout>
    </ScrollView>
</ContentPage>
